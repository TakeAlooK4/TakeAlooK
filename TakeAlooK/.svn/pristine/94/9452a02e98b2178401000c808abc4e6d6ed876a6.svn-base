package com.bit.tak.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.SessionAttributes;
import org.springframework.web.bind.support.SessionStatus;

import com.bit.tak.model.repository.CompanyRepo;
import com.bit.tak.model.service.MemberService;
import com.bit.tak.model.vo.member.Company;


@SessionAttributes("company")
@Controller
public class CompanyMemberController {
	
	@Autowired
	CompanyRepo companyRepo;
	
	@Autowired
	MemberService memberService;
	
		// 기업 회원 로그인(뷰)
		@RequestMapping("/companyLogin")
		public String companyLogin() {
			return "member/companyLogin";
		}
		
		// 기업 유저 로그인 시 보내지는 곳
		@PostMapping("/companyLogin.do")
		public String companyLoginDo(Company company, Model model, @RequestParam("cNo")String cNo, @RequestParam("cPassword")String cPassword) {
			Company findCompany = companyRepo.findByCompany(cNo, cPassword);
			System.out.println("1      :     " + findCompany.getCNo());
			if(findCompany != null && findCompany.getCPassword().equals(company.getCPassword())) {
				model.addAttribute("company", findCompany);
				System.out.println("2     :     " + findCompany.getCPassword());
				return "index";
			} else {
				System.out.println("3       :        "  + findCompany);
				return "redirect:/member/companyLogin";
			}
		}
		
		// 로그아웃 시키는 메소드
		@RequestMapping("/companyLogOut")
		public String logOut(SessionStatus status) {
			status.setComplete();
			return "redirect:/";
		}
		
		// 기업 유저 회원가입(뷰)
		@RequestMapping("/companySignUp")
		public String companySignUp() {
			return "member/companySignUp";
		}
		
		// 기업 유저 회원가입시 보내지는 곳
		@RequestMapping("/companySignUp.do")
		public String companySignUpDo(Company company) {
			
			memberService.companySignUp(company);
			return "redirect:companyLogin";
		}
}
